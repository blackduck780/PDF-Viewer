<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BlueStack PDF Reader â€“ Fast & Modern</title>
  <meta name="description" content="Clean, private PDF viewer with thumbnails, search, dark mode & more."/>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width='100' height='100' rx='20' fill='%23007bff'/><text x='50' y='65' font-size='60' text-anchor='middle' fill='white'>PDF</text></svg>">
  <style>
    :root {
      --primary: #007bff;
      --primary-dark: #0056b3;
      --bg: #f0f4ff;
      --card: rgba(255, 255, 255, 0.92);
      --text: #1a2b4e;
      --border: rgba(0, 123, 255, 0.18);
      --shadow: 0 8px 32px rgba(0, 123, 255, 0.12);
      --highlight: #fffacd;
    }
    [data-theme="dark"] {
      --primary: #4dabf7;
      --primary-dark: #228be6;
      --bg: #0a192f;
      --card: rgba(17, 24, 39, 0.92);
      --text: #e2e8f0;
      --border: rgba(77, 171, 247, 0.22);
      --shadow: 0 8px 32px rgba(0, 123, 255, 0.18);
      --highlight: #4a3e1e;
    }
    body {
      margin: 0;
      height: 100vh;
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, var(--bg), #e0e7ff);
      color: var(--text);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: background 0.4s ease;
    }
    #toolbar {
      background: var(--card);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      box-shadow: var(--shadow);
      z-index: 10;
    }
    #logo {
      font-weight: 700;
      font-size: 1.4em;
      background: linear-gradient(90deg, var(--primary), #00c6ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-right: 12px;
    }
    #toolbar button, #toolbar input, #toolbar select {
      padding: 8px 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: rgba(255,255,255,0.6);
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
    }
    [data-theme="dark"] #toolbar button,
    [data-theme="dark"] #toolbar input {
      background: rgba(30, 41, 59, 0.6);
    }
    #toolbar button:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-1px);
    }
    #container {
      flex: 1;
      display: flex;
      overflow: hidden;
    }
    #sidebar {
      width: 240px;
      background: var(--card);
      backdrop-filter: blur(12px);
      border-right: 1px solid var(--border);
      overflow-y: auto;
      padding: 16px 10px;
      box-shadow: var(--shadow);
      display: none;
    }
    #sidebar.show { display: block; }
    .thumb {
      width: 100%;
      margin-bottom: 14px;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 8px;
      transition: all 0.25s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .thumb:hover { transform: scale(1.04); }
    .thumb.active { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,123,255,0.3); }
    #main {
      flex: 1;
      overflow: auto;
      padding: 24px;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    #pdfViewer {
      background: white;
      box-shadow: var(--shadow);
      border-radius: 12px;
      max-width: 100%;
    }
    [data-theme="dark"] #pdfViewer { background: #1a2236; }
    #search-results {
      margin: 12px 16px;
      max-height: 180px;
      overflow-y: auto;
      font-size: 0.95em;
    }
    #status {
      text-align: center;
      color: #64748b;
      font-size: 0.9em;
      padding: 8px;
    }
    @media (max-width: 768px) {
      #toolbar { padding: 10px; gap: 8px; }
      #sidebar { width: 180px; }
    }
  </style>
</head>
<body>

<div id="toolbar">
  <span id="logo">BlueStack PDF Reader</span>

  <label for="file-input" style="cursor:pointer; font-weight:500; color:var(--primary);">Open PDF</label>
  <input type="file" id="file-input" accept=".pdf"/>

  <button onclick="prevPage()">â—€ Prev</button>
  <span id="page-info">Page 1 / 1</span>
  <button onclick="nextPage()">Next â–¶</button>

  <button onclick="zoomIn()">+ Zoom</button>
  <button onclick="zoomOut()">âˆ’ Zoom</button>

  <button onclick="toggleSidebar()">Thumbnails</button>
  <button onclick="toggleTheme()">ðŸŒ“ Theme</button>
  <button onclick="downloadPDF()">â†“ Download</button>
  <button onclick="window.print()">ðŸ–¨ Print</button>

  <input type="text" id="searchInput" placeholder="Search in document..." style="flex:1; min-width:160px;">
  <button onclick="searchText()">Find</button>
</div>

<div id="container">
  <div id="sidebar">
    <h4 style="margin:0 0 12px; color:var(--primary);">Page Previews</h4>
    <div id="thumbnails"></div>
  </div>
  <div id="main">
    <canvas id="pdfViewer"></canvas>
  </div>
</div>

<div id="search-results"></div>
<div id="status">Ready â€¢ Drag & drop PDF or use Open button</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.min.mjs" type="module"></script>
<script type="module">
  import * as pdfjsLib from 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.min.mjs';

  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.7.76/pdf.worker.min.mjs';

  let pdfDoc = null;
  let pageNum = 1;
  let zoomLevel = 1.5;
  let searchQuery = '';

  const canvas = document.getElementById('pdfViewer');
  const ctx = canvas.getContext('2d');
  const pageInfo = document.getElementById('page-info');
  const thumbnailsDiv = document.getElementById('thumbnails');
  const searchInput = document.getElementById('searchInput');

  // â”€â”€â”€ Render page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function renderPage(num) {
    if (!pdfDoc) return;
    const page = await pdfDoc.getPage(num);
    const viewport = page.getViewport({ scale: zoomLevel });

    canvas.height = viewport.height;
    canvas.width = viewport.width;

    await page.render({
      canvasContext: ctx,
      viewport: viewport
    }).promise;

    pageInfo.textContent = `Page ${num} / ${pdfDoc.numPages}`;
  }

  // â”€â”€â”€ Thumbnails â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function renderThumbnails() {
    thumbnailsDiv.innerHTML = '';
    for (let i = 1; i <= pdfDoc.numPages; i++) {
      const page = await pdfDoc.getPage(i);
      const viewport = page.getViewport({ scale: 0.28 });

      const thumb = document.createElement('canvas');
      thumb.width = viewport.width;
      thumb.height = viewport.height;
      thumb.className = 'thumb';
      thumb.dataset.page = i;

      await page.render({
        canvasContext: thumb.getContext('2d'),
        viewport: viewport
      }).promise;

      thumb.onclick = () => {
        pageNum = i;
        renderPage(pageNum);
        document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
        thumb.classList.add('active');
      };

      if (i === pageNum) thumb.classList.add('active');
      thumbnailsDiv.appendChild(thumb);
    }
  }

  // â”€â”€â”€ Load PDF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadPDF(fileOrUrl, password = null) {
    let loadingTask;

    if (typeof fileOrUrl === 'string') {
      loadingTask = pdfjsLib.getDocument({ url: fileOrUrl, password });
    } else {
      const arrayBuffer = await fileOrUrl.arrayBuffer();
      loadingTask = pdfjsLib.getDocument({ data: arrayBuffer, password });
    }

    try {
      pdfDoc = await loadingTask.promise;
      pageNum = 1;
      zoomLevel = 1.5;
      await renderPage(pageNum);
      await renderThumbnails();
      document.getElementById('status').textContent = `Loaded â€¢ ${pdfDoc.numPages} pages`;
    } catch (err) {
      if (err.name === 'PasswordException') {
        const pwd = prompt("PDF is password-protected. Enter password:");
        if (pwd) return loadPDF(fileOrUrl, pwd);
      }
      document.getElementById('status').textContent = 'Error: ' + err.message;
    }
  }

  // â”€â”€â”€ Controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function prevPage() { if (pageNum > 1) { pageNum--; renderPage(pageNum); } }
  function nextPage() { if (pageNum < pdfDoc?.numPages) { pageNum++; renderPage(pageNum); } }
  function zoomIn() { zoomLevel += 0.25; renderPage(pageNum); }
  function zoomOut() { if (zoomLevel > 0.5) { zoomLevel -= 0.25; renderPage(pageNum); } }

  function toggleTheme() {
    document.body.dataset.theme = document.body.dataset.theme === 'dark' ? '' : 'dark';
    localStorage.setItem('bluestackTheme', document.body.dataset.theme);
  }

  function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('show');
  }

  function downloadPDF() {
    if (!pdfDoc) return;
    const url = URL.createObjectURL(new Blob([pdfDoc.transport.data], { type: 'application/pdf' }));
    const a = document.createElement('a');
    a.href = url;
    a.download = 'document.pdf';
    a.click();
    URL.revokeObjectURL(url);
  }

  // â”€â”€â”€ File & drag-drop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('file-input').addEventListener('change', e => {
    const file = e.target.files[0];
    if (file?.type === 'application/pdf') loadPDF(file);
  });

  document.body.addEventListener('dragover', e => e.preventDefault());
  document.body.addEventListener('drop', e => {
    e.preventDefault();
    const file = e.dataTransfer.files[0];
    if (file?.type === 'application/pdf') loadPDF(file);
  });

  // â”€â”€â”€ Auto dark mode + theme persist â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (localStorage.getItem('bluestackTheme') === 'dark' ||
      (!localStorage.getItem('bluestackTheme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.body.dataset.theme = 'dark';
  }
</script>
</body>
</html>
