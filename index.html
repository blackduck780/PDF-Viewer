<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jio PDF Reader - Android Fixed</title>
  <style>
    /* Your preferred dark cyber theme */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      background: linear-gradient(135deg, #0c0c1a, #1a0033); 
      color: #00ff88; 
      font-family: 'Segoe UI', sans-serif;
      height: 100vh; overflow: hidden;
    }
    #toolbar { 
      background: rgba(0,20,40,0.95); 
      padding: 10px; 
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      display: flex; gap: 10px; backdrop-filter: blur(10px);
    }
    button { background: #00ff88; color: #0c0c1a; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; }
    button:hover { background: #00cc66; }
    #darkToggle { background: #333; color: white; }
    #pdfCanvas { border: 2px solid #00ff88; margin-top: 60px; max-height: calc(100vh - 60px); width: 100%; display: block; background: #121212; }
    #fileInput { display: none; }
    .label { padding: 10px; background: rgba(0,255,136,0.1); border-radius: 5px; cursor: pointer; }
    /* JioPhone + Android mobile optimizations */
    @media (max-width: 480px) { #pdfCanvas { max-width: 100%; image-orientation: from-image; } }
  </style>
</head>
<body>
  <div id="toolbar">
    <label for="fileInput" class="label">üìÅ Upload PDF</label>
    <button onclick="prevPage()">‚¨ÖÔ∏è Prev</button>
    <span id="pageInfo">Page 1 / 1</span>
    <button onclick="nextPage()">Next ‚û°Ô∏è</button>
    <button id="darkToggle" onclick="toggleDark()">üåô Dark</button>
  </div>
  
  <input type="file" id="fileInput" accept=".pdf">
  <canvas id="pdfCanvas"></canvas>

  <!-- Load PDF.js from your repo (upload pdfjs folder first) -->
  <script src="pdfjs/build/pdf.js"></script>
  <script>
    // Global vars
    let pdfDoc = null, pageNum = 1, pageCount = 0;
    let isDark = true;
    
    // File upload - Android File API fix
    document.getElementById('fileInput').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      const arrayBuffer = await file.arrayBuffer();
      pdfDoc = await pdfjsLib.getDocument(arrayBuffer).promise;
      pageCount = pdfDoc.numPages;
      document.getElementById('pageInfo').textContent = `Page 1 / ${pageCount}`;
      renderPage(pageNum);
    });

    // Render single page to canvas (Android canvas fix)
    async function renderPage(num) {
      if (!pdfDoc) return;
      pageNum = Math.min(Math.max(num, 1), pageCount);
      
      const page = await pdfDoc.getPage(pageNum);
      const viewport = page.getViewport({ scale: 1.2 });
      const canvas = document.getElementById('pdfCanvas');
      const context = canvas.getContext('2d');
      
      canvas.height = viewport.height;
      canvas.width = viewport.width;
      
      const renderContext = {
        canvasContext: context,
        viewport: viewport,
        transform: isDark ? [1, 0, 0, -1, 0, viewport.height] : null // Dark mode invert
      };
      
      await page.render(renderContext).promise;
      document.getElementById('pageInfo').textContent = `Page ${pageNum} / ${pageCount}`;
    }

    // Navigation
    function prevPage() { if (pageNum <= 1) return; renderPage(pageNum - 1); }
    function nextPage() { if (pageNum >= pageCount) return; renderPage(pageNum + 1); }

    // Dark theme toggle (invert canvas colors)
    function toggleDark() {
      isDark = !isDark;
      document.body.style.filter = isDark ? 'invert(1) hue-rotate(180deg)' : 'none';
      document.getElementById('pdfCanvas').style.filter = isDark ? 'invert(1) hue-rotate(180deg)' : 'none';
      document.getElementById('darkToggle').textContent = isDark ? '‚òÄÔ∏è Light' : 'üåô Dark';
      if (pdfDoc) renderPage(pageNum); // Re-render
    }

    // PDF.js worker setup (Android compatibility)
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'pdfjs/build/pdf.worker.js';
    
    // Auto dark mode + PWA ready
    toggleDark();
  </script>
</body>
      </html>
